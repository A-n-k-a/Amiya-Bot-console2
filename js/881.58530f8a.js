"use strict";(self["webpackChunkamiyabot_console"]=self["webpackChunkamiyabot_console"]||[]).push([[881],{5159:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ke}});var i=a(3870),l=(a(1758),a(7986)),n=(a(33),a(9971)),o=(a(1430),a(6226),a(2261)),s=(a(6809),a(243)),r=(a(451),a(3396)),d=a(7139);const c=e=>((0,r.dD)("data-v-5892089c"),e=e(),(0,r.Cn)(),e),u={key:0,class:"plugin-manager"},m=["onClick"],p={class:"plugin-icon"},f=["src"],h={style:{"padding-right":"20px"}},g={style:{"font-size":"12px",color:"var(--el-color-primary)"}},y={class:"plugin-page"},w=(0,r.Uk)("重新安装插件"),b=(0,r.Uk)("重载插件"),k=(0,r.Uk)("卸载插件"),v=c((()=>(0,r._)("span",{style:{"padding-right":"5px"}},"插件配置",-1))),_=(0,r.Uk)("updated"),C={key:1};function D(e,t,a,c,D,j){const Z=s.Mr,S=o.mi,F=(0,r.up)("plugin-detail"),W=l.p8,x=n.Ks,U=(0,r.up)("plugin-config-editor"),V=l.Ub,L=i.GT;return(0,r.wg)(),(0,r.iD)("div",null,[e.pluginList.length?((0,r.wg)(),(0,r.iD)("div",u,[(0,r.Wm)(Z,{class:"plugin-list"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.pluginList,((t,a)=>((0,r.wg)(),(0,r.iD)("div",{key:a,class:"plugin-head",onClick:a=>e.plugin=t},[(0,r._)("div",p,[e.pluginLogo(t)?((0,r.wg)(),(0,r.iD)("img",{key:0,src:e.pluginLogo(t),alt:"logo"},null,8,f)):(0,r.kq)("",!0)]),(0,r._)("div",h,[(0,r._)("div",{class:(0,d.C_)(["plugin-title",{selected:e.plugin.plugin_id===t.plugin_id}])},(0,d.zw)(t.name),3),(0,r._)("div",g,(0,d.zw)(t.version),1)])],8,m)))),128))])),_:1}),(0,r._)("div",y,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.pluginList,((a,i)=>((0,r.wg)(),(0,r.iD)(r.HY,{key:i},[e.plugin.plugin_id===a.plugin_id?((0,r.wg)(),(0,r.j4)(V,{key:0,type:"border-card",style:{height:"100%"},class:"plugin-card-body"},{default:(0,r.w5)((()=>[(0,r.Wm)(W,{label:"插件详情",class:"plugin-panel",lazy:""},{default:(0,r.w5)((()=>[(0,r.Wm)(F,{item:a},{button:(0,r.w5)((()=>[(0,r.Wm)(S,{round:"",type:"primary",onClick:t=>e.reload(a,!0)},{default:(0,r.w5)((()=>[w])),_:2},1032,["onClick"]),(0,r.Wm)(S,{round:"",type:"warning",onClick:t=>e.reload(a,!1)},{default:(0,r.w5)((()=>[b])),_:2},1032,["onClick"]),(0,r.Wm)(S,{round:"",type:"danger",onClick:t=>e.uninstall(a)},{default:(0,r.w5)((()=>[k])),_:2},1032,["onClick"])])),_:2},1032,["item"])])),_:2},1024),a.allow_config?((0,r.wg)(),(0,r.j4)(W,{key:0,class:"plugin-panel",lazy:""},{label:(0,r.w5)((()=>[v,e.pluginChanged?((0,r.wg)(),(0,r.j4)(x,{key:0,size:"small",type:"danger",effect:"dark"},{default:(0,r.w5)((()=>[_])),_:1})):(0,r.kq)("",!0)])),default:(0,r.w5)((()=>[(0,r.Wm)(U,{item:a,onChange:t[0]||(t[0]=t=>e.pluginChanged=t)},null,8,["item"])])),_:2},1024)):(0,r.kq)("",!0)])),_:2},1024)):(0,r.kq)("",!0)],64)))),128))])])):((0,r.wg)(),(0,r.iD)("div",C,[(0,r.Wm)(L,{description:"未安装任何插件"})]))])}var j=a(2482),Z=a(6520),S=a(2483),F=a(6532),W=a(2748),x=a(3969),U=a(1955),V=(a(2064),a(5065)),L=(a(3189),a(7113),a(4550)),O=(a(6905),a(9007),a(8631)),Y=(a(7029),a(5120)),q=(a(172),a(6467),a(7567)),z=a(8655),I=(a(3877),a(7960),a(9667)),$=(a(9112),a(3417));const H={class:"form-field-type"},G={key:1,class:"number-input"};function R(e,t,a,i,l,n){const o=$.EZ,s=I.d6,c=z.BT,u=z.km,m=q.iJ,p=Y.ah,f=O.OX;return(0,r.wg)(),(0,r.iD)("div",H,["input"===e.type?((0,r.wg)(),(0,r.j4)(o,{key:0,modelValue:e.form[e.bind],"onUpdate:modelValue":t[0]||(t[0]=t=>e.form[e.bind]=t),size:e.size,placeholder:(e.item.value||`请输入${e.itemLabel(e.item)}`).toString()},(0,r.Nv)({_:2},[e.$slots.append?{name:"append",fn:(0,r.w5)((()=>[(0,r.WI)(e.$slots,"append")]))}:void 0]),1032,["modelValue","size","placeholder"])):(0,r.kq)("",!0),"number"===e.type?((0,r.wg)(),(0,r.iD)("div",G,[(0,r.Wm)(s,{modelValue:e.form[e.bind],"onUpdate:modelValue":t[1]||(t[1]=t=>e.form[e.bind]=t),controls:!1,size:e.size,class:(0,d.C_)({"has-button":e.$slots.append}),min:e.item.minimum,max:e.item.maximum},null,8,["modelValue","size","class","min","max"]),e.$slots.append?(0,r.WI)(e.$slots,"append",{key:0}):(0,r.kq)("",!0)])):(0,r.kq)("",!0),"select"===e.type?((0,r.wg)(),(0,r.j4)(u,{key:2,modelValue:e.form[e.bind],"onUpdate:modelValue":t[2]||(t[2]=t=>e.form[e.bind]=t),placeholder:`请选择${e.itemLabel(e.item)}`,size:e.size},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.item.options,((t,a)=>((0,r.wg)(),(0,r.j4)(c,{key:a,value:e.item.factory(t)},{default:(0,r.w5)((()=>[(0,r.Uk)((0,d.zw)(t),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue","placeholder","size"])):(0,r.kq)("",!0),e.type.startsWith("date")?((0,r.wg)(),(0,r.j4)(m,{key:3,placement:"bottom-start",modelValue:e.form[e.bind],"onUpdate:modelValue":t[3]||(t[3]=t=>e.form[e.bind]=t),type:e.type.replace("-",""),placeholder:`请选择${e.itemLabel(e.item)}`,"value-format":e.format[e.type],"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue","type","placeholder","value-format"])):(0,r.kq)("",!0),e.type.startsWith("time")?((0,r.wg)(),(0,r.j4)(p,{key:4,placement:"bottom-start",modelValue:e.form[e.bind],"onUpdate:modelValue":t[4]||(t[4]=t=>e.form[e.bind]=t),"is-range":e.type.endsWith("range"),placeholder:`请选择${e.itemLabel(e.item)}`,"value-format":e.format[e.type],"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue","is-range","placeholder","value-format"])):(0,r.kq)("",!0),"boolean"===e.type?((0,r.wg)(),(0,r.j4)(f,{key:5,modelValue:e.form[e.bind],"onUpdate:modelValue":t[5]||(t[5]=t=>e.form[e.bind]=t),size:e.size},null,8,["modelValue","size"])):(0,r.kq)("",!0)])}var N=function(e,t,a,i){var l,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(l=e[s])&&(o=(n<3?l(o):n>3?l(t,a,o):l(t,a))||o);return n>3&&o&&Object.defineProperty(t,a,o),o};let P=class extends Z.w3{};P=N([(0,Z.Ei)({props:["item","form","bind","size","itemLabel"],computed:{type(){return this.item.subType||this.item.type}},data(){return{format:{date:"YYYY-MM-DD",time:"HH:mm:ss",datetime:"YYYY-MM-DD HH:mm:ss","date-range":"YYYY-MM-DD","time-range":"HH:mm:ss","datetime-range":"YYYY-MM-DD HH:mm:ss"}}}})],P);var T=P,A=a(89);const J=(0,A.Z)(T,[["render",R]]);var K=J,M=a(4143),E=(a(7437),a(95)),B=(a(4566),a(1015));a(8474);const X={class:"item-label"},Q={style:{"padding-right":"5px"}},ee={key:0,style:{width:"100%"}},te=(0,r.Uk)("添加"),ae={class:"table-header"},ie=(0,r.Uk)("删除"),le=(0,r.Uk)(" 添加 "),ne=(0,r.Uk)(" 不支持的编辑类型 ");function oe(e,t,a,i,l,n){const s=(0,r.up)("QuestionFilled"),c=B.gn,u=E.Q0,m=(0,r.up)("form-field-generator",!0),p=M.Kf,f=o.mi,h=K,g=V.E2,y=L.$Y,w=L.eI,b=U.nH;return(0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.items,((t,a)=>((0,r.wg)(),(0,r.j4)(b,{key:a,style:(0,d.j5)(e.itemStyle(t)),class:(0,d.C_)(["v-table",{"is-required":t.required}])},{label:(0,r.w5)((()=>[(0,r._)("div",X,[(0,r._)("span",Q,(0,d.zw)(e.itemLabel(t)),1),t.description?((0,r.wg)(),(0,r.j4)(u,{key:0,placement:"top"},{content:(0,r.w5)((()=>[(0,r.Uk)((0,d.zw)(t.description),1)])),default:(0,r.w5)((()=>[(0,r.Wm)(c,{style:{cursor:"help"}},{default:(0,r.w5)((()=>[(0,r.Wm)(s)])),_:1})])),_:2},1024)):(0,r.kq)("",!0)])])),default:(0,r.w5)((()=>["form"===t.type?((0,r.wg)(),(0,r.j4)(p,{key:0,style:{width:"100%"}},{default:(0,r.w5)((()=>[(0,r.Wm)(m,{form:e.form[t.field],items:t.formItems},null,8,["form","items"])])),_:2},1024)):"values"===t.type?((0,r.wg)(),(0,r.iD)(r.HY,{key:1},[e.form[t.field]&&e.form[t.field].length?((0,r.wg)(),(0,r.iD)("div",ee,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.form[t.field],((a,i)=>((0,r.wg)(),(0,r.iD)("div",{key:i,class:"array-input"},[void 0!==e.form[t.field][i]?((0,r.wg)(),(0,r.j4)(h,{key:0,form:e.form[t.field],bind:i.toString(),item:t,"item-label":e.itemLabel,class:(0,d.C_)(t.field+i)},{append:(0,r.w5)((()=>[(0,r.Wm)(f,{onClick:a=>e.delValue(t,Number(i)),icon:e.delIcon},null,8,["onClick","icon"])])),_:2},1032,["form","bind","item","item-label","class"])):(0,r.kq)("",!0),i===e.form[t.field].length-1?((0,r.wg)(),(0,r.j4)(f,{key:1,onClick:a=>e.addValue(t),style:{"margin-left":"5px"},icon:e.addIcon},null,8,["onClick","icon"])):(0,r.kq)("",!0)])))),128))])):((0,r.wg)(),(0,r.j4)(f,{key:1,onClick:a=>e.addValue(t),icon:e.addIcon},null,8,["onClick","icon"]))],64)):"table"===t.type?((0,r.wg)(),(0,r.j4)(p,{key:2,style:{width:"100%"}},{default:(0,r.w5)((()=>[(0,r.Wm)(w,{border:"","header-cell-class-name":"v-table-header",data:e.form[t.field],style:{width:"100%"}},{empty:(0,r.w5)((()=>[(0,r.Wm)(g,{type:"primary",onClick:a=>e.addRow(t)},{default:(0,r.w5)((()=>[te])),_:2},1032,["onClick"])])),default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.tableForm.formItems,((a,i)=>((0,r.wg)(),(0,r.j4)(y,{key:i,prop:a.field},{header:(0,r.w5)((()=>[(0,r._)("div",ae,[(0,r._)("span",null,(0,d.zw)(e.$t(a.title||a.field)),1),a.description?((0,r.wg)(),(0,r.j4)(u,{key:0,placement:"top"},{content:(0,r.w5)((()=>[(0,r.Uk)((0,d.zw)(a.description),1)])),default:(0,r.w5)((()=>[(0,r.Wm)(c,{style:{cursor:"help","margin-left":"5px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(s)])),_:1})])),_:2},1024)):(0,r.kq)("",!0)])])),default:(0,r.w5)((i=>[(0,r.Wm)(h,{style:{border:"none"},size:"small",item:a,"item-label":e.itemLabel,form:e.form[t.field][i.$index],bind:a.field},null,8,["item","item-label","form","bind"])])),_:2},1032,["prop"])))),128)),(0,r.Wm)(y,{label:"操作"},{default:(0,r.w5)((a=>[(0,r.Wm)(g,{type:"danger",onClick:i=>e.delRow(t,a.$index)},{default:(0,r.w5)((()=>[ie])),_:2},1032,["onClick"]),a.$index===e.form[t.field].length-1?((0,r.wg)(),(0,r.j4)(g,{key:0,type:"primary",onClick:a=>e.addRow(t)},{default:(0,r.w5)((()=>[le])),_:2},1032,["onClick"])):(0,r.kq)("",!0)])),_:2},1024)])),_:2},1032,["data"])])),_:2},1024)):"unsupported"===t.type?((0,r.wg)(),(0,r.iD)(r.HY,{key:3},[ne],64)):((0,r.wg)(),(0,r.j4)(h,{key:4,form:e.form,bind:t.field,item:t,"item-label":e.itemLabel},null,8,["form","bind","item","item-label"]))])),_:2},1032,["style","class"])))),128)}var se=a(4870),re=function(e,t,a,i){var l,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(l=e[s])&&(o=(n<3?l(o):n>3?l(t,a,o):l(t,a))||o);return n>3&&o&&Object.defineProperty(t,a,o),o};let de=class extends Z.w3{constructor(...e){super(...e),(0,j.Z)(this,"form",void 0)}itemLabel(e){return this.$t(e.title||e.name||e.field||"undefined")}itemStyle(e){return{width:"form"===e.type||"table"===e.type?"100%":"60%",marginBottom:"18px"}}addValue(e){Array.isArray(this.form[e.field])||(this.form[e.field]=[]);let t=e.factory("");isNaN(t)&&(t=0),this.form[e.field].push(t),this.$nextTick((()=>{const t=e.field+(this.form[e.field].length-1);document.querySelector("."+t)?.scrollIntoView({behavior:"smooth"})}))}delValue(e,t){this.form[e.field].splice(t,1)}addRow(e){const t={};for(const a of e.tableForm.formItems)t[a.field]=a.factory("");Array.isArray(this.form[e.field])||(this.form[e.field]=[]),this.form[e.field].push(t)}delRow(e,t){this.form[e.field].splice(t,1)}};de=re([(0,Z.Ei)({name:"formFieldGenerator",components:{QuestionFilled:W.Ruj,FormFieldType:K},props:{form:{type:Object,default:()=>({})},items:Array},data(){return{addIcon:(0,se.XI)(W.v37),delIcon:(0,se.XI)(W.WF_)}}})],de);var ce=de;const ue=(0,A.Z)(ce,[["render",oe],["__scopeId","data-v-5132f04a"]]);var me=ue;const pe={key:0,style:{height:"100%",overflow:"auto"}},fe=(0,r.Uk)("群组"),he=(0,r.Uk)("全局"),ge={class:"config-option"},ye=(0,r.Uk)("群组"),we=(0,r.Uk)("全局"),be=(0,r.Uk)(" 保存 "),ke=(0,r.Uk)(" 重置为默认 "),ve=(0,r.Uk)("另存为..."),_e=(0,r.Uk)("删除"),Ce=(0,r.Uk)("新建群组配置"),De={style:{display:"flex"}},je=(0,r.Uk)(" 该插件无全局配置选项，请 "),Ze=(0,r.Uk)("选择 "),Se=(0,r.Uk)(" 或 "),Fe=(0,r.Uk)("新建群组配置 ");function We(e,t,a,l,s,c){const u=n.Ks,m=z.BT,p=z.km,f=o.mi,h=U.nH,g=me,y=V.E2,w=i.GT,b=U.ly;return(e.channelGenerator||e.globalGenerator)&&e.channelList.length?((0,r.wg)(),(0,r.iD)("div",pe,[(0,r.Wm)(b,{"label-width":"auto"},{default:(0,r.w5)((()=>[(0,r.Wm)(h,{label:"选择配置"},{default:(0,r.w5)((()=>[(0,r.Wm)(p,{modelValue:e.selectedSource,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selectedSource=t),onChange:e.getSourceConfig,ref:"selectSource"},{prefix:(0,r.w5)((()=>[e.selectedSource?((0,r.wg)(),(0,r.j4)(u,{key:0,type:"success","disable-transitions":""},{default:(0,r.w5)((()=>[fe])),_:1})):((0,r.wg)(),(0,r.j4)(u,{key:1,type:"danger","disable-transitions":""},{default:(0,r.w5)((()=>[he])),_:1}))])),default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.channelList,(e=>((0,r.wg)(),(0,r.j4)(m,{key:e.value,label:e.label,value:e.value},{default:(0,r.w5)((()=>[(0,r._)("div",ge,[(0,r._)("span",null,(0,d.zw)(e.label),1),e.value?((0,r.wg)(),(0,r.j4)(u,{key:0,type:"success","disable-transitions":""},{default:(0,r.w5)((()=>[ye])),_:1})):((0,r.wg)(),(0,r.j4)(u,{key:1,type:"danger","disable-transitions":""},{default:(0,r.w5)((()=>[we])),_:1}))])])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),(0,r.Wm)(f,{style:{"margin-left":"10px"},type:e.hasChanged?"success":"",disabled:!e.hasChanged,onClick:e.save},{default:(0,r.w5)((()=>[be])),_:1},8,["type","disabled","onClick"]),(0,r.Wm)(f,{type:"warning",onClick:e.reset},{default:(0,r.w5)((()=>[ke])),_:1},8,["onClick"]),e.channelGenerator?((0,r.wg)(),(0,r.iD)(r.HY,{key:0},[e.selectedSource?((0,r.wg)(),(0,r.j4)(f,{key:0,onClick:e.saveAs},{default:(0,r.w5)((()=>[ve])),_:1},8,["onClick"])):(0,r.kq)("",!0),e.selectedSource?((0,r.wg)(),(0,r.j4)(f,{key:1,type:"danger",onClick:e.deleteConfig},{default:(0,r.w5)((()=>[_e])),_:1},8,["onClick"])):(0,r.kq)("",!0),(0,r.Wm)(f,{type:"primary",onClick:e.newChannel},{default:(0,r.w5)((()=>[Ce])),_:1},8,["onClick"])],64)):(0,r.kq)("",!0)])),_:1}),e.selectedSource?((0,r.wg)(),(0,r.j4)(g,{key:0,form:e.channelFormData,items:e.channelGenerator.form.formItems},null,8,["form","items"])):e.globalGenerator?((0,r.wg)(),(0,r.j4)(g,{key:1,form:e.globalFormData,items:e.globalGenerator.form.formItems},null,8,["form","items"])):((0,r.wg)(),(0,r.j4)(w,{key:2},{description:(0,r.w5)((()=>[(0,r._)("div",De,[je,(0,r.Wm)(y,{type:"primary",onClick:t[1]||(t[1]=()=>e.$refs.selectSource.focus())},{default:(0,r.w5)((()=>[Ze])),_:1}),Se,(0,r.Wm)(y,{type:"primary",onClick:e.newChannel},{default:(0,r.w5)((()=>[Fe])),_:1},8,["onClick"])])])),_:1}))])),_:1})])):((0,r.wg)(),(0,r.j4)(w,{key:1,description:"无插件配置"}))}var xe=a(8418);const Ue=["date","time","datetime","date-range","time-range","datetime-range"];class Ve{constructor(e){(0,j.Z)(this,"type","input"),(0,j.Z)(this,"field",void 0),(0,j.Z)(this,"value",""),(0,j.Z)(this,"title",""),(0,j.Z)(this,"description",""),(0,j.Z)(this,"required",!1),(0,j.Z)(this,"minimum",-1/0),(0,j.Z)(this,"maximum",1/0),(0,j.Z)(this,"subType",""),(0,j.Z)(this,"tableForm",null),(0,j.Z)(this,"options",{}),(0,j.Z)(this,"factory",String),this.field=e}}class Le{constructor(e,t=""){(0,j.Z)(this,"type","form"),(0,j.Z)(this,"name",void 0),(0,j.Z)(this,"field",void 0),(0,j.Z)(this,"description",""),(0,j.Z)(this,"formItems",[]),this.name=e,this.field=t}append(e){this.formItems.push(e)}}class Oe{static build(e,t){for(const a in e){const i=this.buildField(a,e[a]);i&&t.append(i)}return t}static buildField(e,t){const a=new Ve(e);switch(a.value=t,a.factory=null!==t?t.constructor:String,a.factory){case Object:return this.build(t,new Le(e,e));case Array:a.type="values",a.factory=t.length?t[0].constructor:String,a.factory===Object&&(a.type="table",a.tableForm=this.build(t[0],new Le(e,e))),a.factory===Array&&(a.type="unsupported");break;case Number:a.type="number";break;case Boolean:a.type="boolean";break}return a}}class Ye{static build(e,t,a,i){const l=new Le(t,i);l.description=a;for(const n in e.properties){const t=e.properties[n],a=new Ve(n);if(a.title=t.title,a.value=t.default,a.description=t.description,a.required=!!(e.required&&e.required.indexOf(n)>=0),t.enum&&t.enum.length)this.buildSelector(a,t);else switch(t.type){case"object":l.append(this.build(t,a.title,a.description,n));continue;case"array":if(a.type="values",a.subType="input",t.items)switch(t.items.type){case"number":case"integer":a.subType="number",a.factory="integer"===t.items.type?parseInt:Number,a.minimum=t.items.minimum||-1/0,a.maximum=t.items.maximum||1/0;break;case"object":a.type="table",a.tableForm=this.build(t.items,a.title,a.description,n);break}a.value||(a.value=[]);break;case"boolean":a.type="boolean",a.factory=Boolean,a.value||(a.value=!1);break;case"string":t.format&&Ue.indexOf(t.format)>=0&&(a.type=t.format,a.type.endsWith("range")&&!Array.isArray(a.value)&&(a.value=[]));break;case"number":case"integer":a.type="number",a.factory="integer"===t.type?parseInt:Number,a.minimum=t.minimum||-1/0,a.maximum=t.maximum||1/0,a.value||(a.value=0);break;case"null":continue}l.append(a)}return l}static buildSelector(e,t){e.type="select",e.factory=t.enum[0].constructor;for(const a of t.enum)e.options[a]=a}}class qe{constructor(e,t=!1){(0,j.Z)(this,"form",void 0),this.form=t?Ye.build(e,"","",""):Oe.build(xe.Z.deepCopy(e),new Le(""))}}var ze=a(9037),Ie=function(e,t,a,i){var l,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(l=e[s])&&(o=(n<3?l(o):n>3?l(t,a,o):l(t,a))||o);return n>3&&o&&Object.defineProperty(t,a,o),o};let $e=class extends Z.w3{constructor(...e){super(...e),(0,j.Z)(this,"item",void 0),(0,j.Z)(this,"globalGenerator",void 0),(0,j.Z)(this,"channelGenerator",void 0),(0,j.Z)(this,"globalFormData",{}),(0,j.Z)(this,"globalFormDefaultData",{}),(0,j.Z)(this,"channelFormData",{}),(0,j.Z)(this,"channelFormDefaultData",{}),(0,j.Z)(this,"channelConfigSaved",{}),(0,j.Z)(this,"selectedSource",""),(0,j.Z)(this,"channelList",[]),(0,j.Z)(this,"hasChanged",!1)}async initConfig(){const e=await(0,F.Gx)({plugin_id:this.item.plugin_id});e.data&&("null"!==e.data.global_config_default&&(this.globalFormData=JSON.parse(e.data.global_config_default),this.globalFormDefaultData=JSON.parse(e.data.global_config_default),"null"!==e.data.global_config_schema?this.globalGenerator=new qe(JSON.parse(e.data.global_config_schema),!0):this.globalGenerator=new qe(this.globalFormData)),"null"!==e.data.channel_config_default&&(this.channelFormData=JSON.parse(e.data.channel_config_default),this.channelFormDefaultData=JSON.parse(e.data.channel_config_default),"null"!==e.data.channel_config_schema?this.channelGenerator=new qe(JSON.parse(e.data.channel_config_schema),!0):this.channelGenerator=new qe(this.channelFormData))),await this.getConfig()}async getConfig(){const e=await(0,F.Xd)({plugin_id:this.item.plugin_id});if(e){const t=[{label:"全局配置",value:""}];for(const a in e.data)a&&t.push({label:a,value:a});this.channelList=t,this.channelConfigSaved=e.data,await this.getSourceConfig(this.selectedSource)}this.hasChanged=!1}async getSourceConfig(e){if(e)return e in this.channelConfigSaved?(this.channelFormData=JSON.parse(this.channelConfigSaved[e]),void await this.$nextTick((()=>this.hasChanged=!1))):(this.channelFormData=xe.Z.deepCopy(this.channelFormDefaultData),void await this.$nextTick((()=>this.hasChanged=!1)));this.globalFormData=this.channelConfigSaved[""]?JSON.parse(this.channelConfigSaved[""]):xe.Z.deepCopy(this.globalFormDefaultData),await this.$nextTick((()=>this.hasChanged=!1))}async save(){await(0,F.ax)({plugin_id:this.item.plugin_id,channel_id:this.selectedSource,config_json:JSON.stringify(this.selectedSource?this.channelFormData:this.globalFormData)}),await this.getConfig()}async reset(){this.selectedSource?this.channelFormData=xe.Z.deepCopy(this.channelFormDefaultData):this.globalFormData=xe.Z.deepCopy(this.globalFormDefaultData)}async saveAs(){const e=await ze.Z.prompt("请输入频道/群组号","另存为新群组配置");e&&(this.channelList.push({label:e,value:e}),this.selectedSource=e,await this.save())}async deleteConfig(){const e=await ze.Z.confirm(`确定删除群号【${this.selectedSource}】的配置`,"删除配置");if(e){await(0,F.pE)({plugin_id:this.item.plugin_id,channel_id:this.selectedSource});let e=null;for(const t in this.channelList)if(this.channelList[t].value===this.selectedSource){e=parseInt(t);break}null!==e&&(this.channelList.splice(e,1),this.channelList.length?this.selectedSource=this.channelList[0].value:this.selectedSource=""),await this.getConfig()}}async newChannel(){const e=await ze.Z.prompt("请输入频道/群组号","新建配置");e&&(this.selectedSource=e,this.channelFormData=xe.Z.deepCopy(this.channelFormDefaultData))}};$e=Ie([(0,Z.Ei)({props:{item:Object},components:{FormFieldGenerator:me},watch:{globalFormData:{handler(){this.hasChanged=!0},deep:!0},channelFormData:{handler(){this.hasChanged=!0},deep:!0},hasChanged(e){this.$emit("change",e)}},data(){return{globalGenerator:null,channelGenerator:null}},mounted(){this.initConfig()}})],$e);var He=$e;const Ge=(0,A.Z)(He,[["render",We],["__scopeId","data-v-7a0aa54b"]]);var Re=Ge,Ne=a(534),Pe=function(e,t,a,i){var l,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(l=e[s])&&(o=(n<3?l(o):n>3?l(t,a,o):l(t,a))||o);return n>3&&o&&Object.defineProperty(t,a,o),o};let Te=class extends Z.w3{constructor(...e){super(...e),(0,j.Z)(this,"pluginList",[]),(0,j.Z)(this,"plugin",{logo:"",name:"",version:"",plugin_id:"",plugin_type:"",description:"",document:"",instruction:"",allow_config:!1}),(0,j.Z)(this,"pluginChanged",!1)}pluginLogo(e){return(0,x.V)(e)}async getPlugin(){const e=await(0,F.M4)();e&&(this.pluginList=e.data,e.data.length&&(this.plugin=e.data[0]))}async uninstall(e){const t=await(0,F.GP)(e);t&&await this.getPlugin()}async reload(e,t){const a=await(0,F.p$)(e,t);a&&await this.getPlugin()}async checkUpdated(){return!this.pluginChanged||await ze.Z.confirm("当前配置尚未保存，是否放弃修改？","注意","warning",["放弃","再想一想"])}};Te=Pe([(0,Z.Ei)({components:{PluginDetail:x.Z,PluginConfigEditor:Re,VDialog:Ne.Z,Warning:W.v3j},watch:{plugin:{handler(){this.pluginChanged=!1},deep:!0}},mounted(){this.getPlugin(),(0,S.iS)(((e,t,a)=>{this.pluginChanged?ze.Z.confirm("当前配置尚未保存，是否放弃修改？","注意","warning",["放弃","再想一想"]).then(a):a()}))}})],Te);var Ae=Te;const Je=(0,A.Z)(Ae,[["render",D],["__scopeId","data-v-5892089c"]]);var Ke=Je},9112:function(e,t,a){a(1758),a(172)},7960:function(e,t,a){a(1758)},3877:function(e,t,a){a(1758),a(172),a(1430),a(7960),a(451),a(6467)},7029:function(e,t,a){a(1758)},6226:function(e,t,a){a(1758)},33:function(e,t,a){a(1758)}}]);
//# sourceMappingURL=881.58530f8a.js.map