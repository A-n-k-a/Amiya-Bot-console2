"use strict";(self["webpackChunkamiyabot_console"]=self["webpackChunkamiyabot_console"]||[]).push([[865],{4180:function(e,t,a){a.d(t,{Cv:function(){return i},IX:function(){return n},db:function(){return r},jW:function(){return d},pB:function(){return s}});var o=a(8199);const l=new o.Z;async function n(){return await l.get({url:"/bot/getAllBot"})}async function i(e){return await l.post({url:e.id?"/bot/editBot":"/bot/addBot",data:e})}async function r(e){return await l.post({url:"/bot/stopBot",data:e})}async function d(e){return await l.post({url:"/bot/runBot",data:e})}async function s(e){return await l.post({url:"/bot/deleteBot",data:e})}},8288:function(e,t,a){a.d(t,{Z:function(){return C}});var o=a(1015),l=(a(8474),a(3191)),n=(a(1758),a(3877),a(4550)),i=(a(6905),a(9007),a(3417)),r=(a(172),a(2261)),d=(a(6809),a(3396));const s={class:"v-table"},u={class:"header-area"},c=["innerHTML"],m=["innerHTML"],f={class:"v-bottom"};function p(e,t,a,p,h,w){const g=r.mi,b=i.EZ,_=n.$Y,y=n.eI,k=l.R,W=(0,d.up)("Refresh"),v=o.gn;return(0,d.wg)(),(0,d.iD)("div",s,[(0,d._)("div",u,[(0,d._)("div",null,[(0,d.WI)(e.$slots,"header")]),(0,d.Wm)(b,{style:{width:"520px"},modelValue:e.searchInput,"onUpdate:modelValue":t[0]||(t[0]=t=>e.searchInput=t),placeholder:"输入任意值搜索...",onChange:t[1]||(t[1]=t=>e.executeLoad(!0))},{append:(0,d.w5)((()=>[(0,d.Wm)(g,{icon:e.searchIcon},null,8,["icon"])])),_:1},8,["modelValue"])]),(0,d.Wm)(y,{data:e.tableData,stripe:"","header-cell-class-name":"v-table-header",ref:"table","empty-text":"暂无数据","max-height":600},{default:(0,d.w5)((()=>[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(e.columns,((t,a)=>((0,d.wg)(),(0,d.j4)(_,{"show-overflow-tooltip":"",width:t.width||e.colWidth[t.field],"class-name":"mark_"+t.field,key:a,prop:t.field,label:t.title},{default:(0,d.w5)((a=>[(0,d.WI)(e.$slots,"cell",{row:a.row,field:t.field,value:a.row[t.field],index:a.$index},(()=>[t.format?((0,d.wg)(),(0,d.iD)("div",{key:0,innerHTML:t.format(a.row,a.row[t.field],a.$index)},null,8,c)):((0,d.wg)(),(0,d.iD)("div",{key:1,innerHTML:a.row[t.field]},null,8,m))]))])),_:2},1032,["width","class-name","prop","label"])))),128)),this.$slots.operations?((0,d.wg)(),(0,d.j4)(_,{key:0,label:"操作",fixed:"right","class-name":"mark_operation",width:e.colWidth.operation},{default:(0,d.w5)((t=>[(0,d.WI)(e.$slots,"operations",{row:t.row,index:t.$index})])),_:3},8,["width"])):(0,d.kq)("",!0)])),_:3},8,["data"]),(0,d._)("div",f,[(0,d.Wm)(k,{layout:e.pagination?"total, prev, pager, next, sizes, jumper":"total",small:!0,background:!0,currentPage:e.currentPage,"onUpdate:currentPage":t[2]||(t[2]=t=>e.currentPage=t),"page-size":e.pageSize,"onUpdate:page-size":t[3]||(t[3]=t=>e.pageSize=t),total:e.total,"onUpdate:total":t[4]||(t[4]=t=>e.total=t),onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["layout","currentPage","page-size","total","onSizeChange","onCurrentChange"]),(0,d.Wm)(v,{class:"v-bottom-icon",size:20,onClick:t[5]||(t[5]=t=>e.executeLoad())},{default:(0,d.w5)((()=>[(0,d.Wm)(W)])),_:1})])])}var h=a(2482),w=a(4870),g=a(6520);function b(e,t=50){const a=e.clientWidth,o={};let l=0;if(0===a)return{};const n=e.querySelectorAll("tr");n.forEach((e=>{e.querySelectorAll("td, th").forEach((e=>{const a=e.querySelector(".cell"),l=e.querySelectorAll(".cell > *"),n=e.className.match(/mark_(\S+)/);let i=t;for(const t of l)i+=t.offsetWidth;if(n){const e=n[1];"operation"===e&&(i+=30),e in o?o[e]<i&&(o[e]=i):o[e]=a?.offsetWidth||0}}))}));for(const i in o)l+=o[i];if(l<a){let e=Object.keys(o).length;"selection"in o&&(e-=1),"operation"in o&&(e-=1);const t=(a-l)/e;for(const a in o)"selection"!==a&&"operation"!==a&&(o[a]+=t)}return o}var _=a(2748),y=function(e,t,a,o){var l,n=arguments.length,i=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,a,o);else for(var r=e.length-1;r>=0;r--)(l=e[r])&&(i=(n<3?l(i):n>3?l(t,a,i):l(t,a))||i);return n>3&&i&&Object.defineProperty(t,a,i),i};let k=class extends g.w3{constructor(...e){super(...e),(0,h.Z)(this,"load",void 0),(0,h.Z)(this,"searchIcon",(0,w.XI)(_.olm)),(0,h.Z)(this,"searchInput",""),(0,h.Z)(this,"tableData",[]),(0,h.Z)(this,"columns",[]),(0,h.Z)(this,"colWidth",{}),(0,h.Z)(this,"pagination",!1),(0,h.Z)(this,"currentPage",1),(0,h.Z)(this,"pageSize",10),(0,h.Z)(this,"total",0)}getColumns(){return{columns:this.columns,colWidth:this.colWidth}}setData(e){this.tableData=e,this.total=e.length,this.pagination=!1}setPaginationData(e){this.tableData=e.list,this.total=e.total,this.pagination=!0}setColumns(e){const t=[];for(const a in e){const o=e[a];o.constructor===String?t.push({field:a,title:o}):(o.field||(o.field=a),t.push(o))}this.columns=t,this.executeLoad()}executeLoad(e=!1){e&&(this.currentPage=1),this.load({currentPage:this.currentPage,pageSize:this.pageSize,search:this.searchInput})}handleSizeChange(){this.executeLoad()}handleCurrentChange(){this.executeLoad()}};k=y([(0,g.Ei)({components:{Refresh:_.hYj},props:{load:{type:Function,default:()=>null}},computed:{table(){return this.$refs.table}},methods:{resetWidth(){setTimeout((()=>{this.colWidth=b(this.table.$el)}),200)}},watch:{tableData:{handler(){this.resetWidth()},deep:!0}}})],k);var W=k,v=a(89);const V=(0,v.Z)(W,[["render",p]]);var C=V},5860:function(e,t,a){a.d(t,{Z:function(){return p}});var o=a(7947),l=(a(9910),a(1955)),n=(a(2064),a(3396));function i(e,t,a,i,r,d){const s=l.ly,u=o.d0;return(0,n.wg)(),(0,n.j4)(u,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=t=>e.dialogVisible=t),title:e.title,"append-to-body":e.appendToBody,width:e.width},{footer:(0,n.w5)((()=>[(0,n.WI)(e.$slots,"footer")])),default:(0,n.w5)((()=>[(0,n.Wm)(s,{model:e.form,"label-width":e.labelWidth},{default:(0,n.w5)((()=>[(0,n.WI)(e.$slots,"default")])),_:3},8,["model","label-width"])])),_:3},8,["modelValue","title","append-to-body","width"])}var r=a(2482),d=a(6520),s=function(e,t,a,o){var l,n=arguments.length,i=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,a,o);else for(var r=e.length-1;r>=0;r--)(l=e[r])&&(i=(n<3?l(i):n>3?l(t,a,i):l(t,a))||i);return n>3&&i&&Object.defineProperty(t,a,i),i};let u=class extends d.w3{constructor(...e){super(...e),(0,r.Z)(this,"form",void 0),(0,r.Z)(this,"title",void 0),(0,r.Z)(this,"dialogVisible",!1)}show(){this.dialogVisible=!0}async asyncShow(){this.dialogVisible=!0,await this.$nextTick()}hide(){this.dialogVisible=!1}async asyncHide(){this.dialogVisible=!1,await this.$nextTick()}};u=s([(0,d.Ei)({props:{form:Object,title:String,width:Number,appendToBody:Boolean,labelWidth:{type:String,default:()=>"100px"}}})],u);var c=u,m=a(89);const f=(0,m.Z)(c,[["render",i]]);var p=f},3865:function(e,t,a){a.r(t),a.d(t,{default:function(){return H}});var o=a(5860),l=a(9667),n=(a(9112),a(3838)),i=(a(1758),a(1244)),r=(a(7219),a(8631)),d=(a(7029),a(8655)),s=(a(3877),a(7960),a(1955)),u=(a(7113),a(3417)),c=(a(172),a(8288)),m=a(5065),f=(a(3189),a(9971)),p=(a(1430),a(2261)),h=(a(6809),a(3396)),w=a(7139);const g={class:"instance-manage"},b=(0,h.Uk)("添加实例"),_=(0,h.Uk)("其他"),y=(0,h.Uk)("编辑"),k=(0,h.Uk)("关闭"),W=(0,h.Uk)("运行"),v=(0,h.Uk)("删除"),V=(0,h.Uk)("配置"),C=(0,h.Uk)("公域"),U=(0,h.Uk)("私域"),x=(0,h.Uk)("服务配置"),Z=(0,h.Uk)("保存"),q=(0,h.Uk)("保存并启动");function j(e,t,a,j,D,B){const T=p.mi,S=f.Ks,P=m.E2,I=c.Z,$=u.EZ,O=s.nH,z=d.BT,H=d.km,L=r.OX,R=i.os,A=n.rh,Q=n.KD,E=l.d6,Y=o.Z;return(0,h.wg)(),(0,h.iD)("div",g,[(0,h.Wm)(I,{ref:"table",load:e.loadList},{header:(0,h.w5)((()=>[(0,h.Wm)(T,{type:"primary",onClick:e.addBot},{default:(0,h.w5)((()=>[b])),_:1},8,["onClick"])])),cell:(0,h.w5)((({value:e,field:t,row:a})=>["private"===t?((0,h.wg)(),(0,h.iD)(h.HY,{key:0},["tencent"===a.adapter?((0,h.wg)(),(0,h.j4)(S,{key:0,type:e?"":"success"},{default:(0,h.w5)((()=>[(0,h.Uk)((0,w.zw)(e?"私域":"公域"),1)])),_:2},1032,["type"])):((0,h.wg)(),(0,h.j4)(S,{key:1,type:"warning"},{default:(0,h.w5)((()=>[_])),_:1}))],64)):(0,h.kq)("",!0),"is_main"===t?((0,h.wg)(),(0,h.j4)(S,{key:1,type:e?"success":"info"},{default:(0,h.w5)((()=>[(0,h.Uk)((0,w.zw)(e?"是":"否"),1)])),_:2},1032,["type"])):(0,h.kq)("",!0),"is_start"===t?((0,h.wg)(),(0,h.j4)(S,{key:2,type:e?"success":"info"},{default:(0,h.w5)((()=>[(0,h.Uk)((0,w.zw)(e?"是":"否"),1)])),_:2},1032,["type"])):(0,h.kq)("",!0)])),operations:(0,h.w5)((({row:t})=>[(0,h.Wm)(P,{underline:!1,type:"primary",onClick:a=>e.editBot(t)},{default:(0,h.w5)((()=>[y])),_:2},1032,["onClick"]),t.running?((0,h.wg)(),(0,h.j4)(P,{key:0,underline:!1,type:"warning",onClick:a=>e.closeBot(t)},{default:(0,h.w5)((()=>[k])),_:2},1032,["onClick"])):((0,h.wg)(),(0,h.j4)(P,{key:1,underline:!1,type:"success",onClick:a=>e.runBot(t)},{default:(0,h.w5)((()=>[W])),_:2},1032,["onClick"])),(0,h.Wm)(P,{underline:!1,type:"danger",onClick:a=>e.deleteBot(t)},{default:(0,h.w5)((()=>[v])),_:2},1032,["onClick"])])),_:1},8,["load"]),(0,h.Wm)(Y,{title:"编辑实例",form:e.form,ref:"dialog"},{footer:(0,h.w5)((()=>[(0,h.Wm)(T,{type:"primary",onClick:t[15]||(t[15]=t=>e.submit(0))},{default:(0,h.w5)((()=>[Z])),_:1}),e.form.running?(0,h.kq)("",!0):((0,h.wg)(),(0,h.j4)(T,{key:0,type:"success",onClick:t[16]||(t[16]=t=>e.submit(1))},{default:(0,h.w5)((()=>[q])),_:1}))])),default:(0,h.w5)((()=>[(0,h.Wm)(O,{label:"AppID"},{default:(0,h.w5)((()=>[(0,h.Wm)($,{modelValue:e.form.appid,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.appid=t),placeholder:"机器人ID"},null,8,["modelValue"])])),_:1}),(0,h.Wm)(O,{label:"Token"},{default:(0,h.w5)((()=>[(0,h.Wm)($,{modelValue:e.form.token,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.token=t),placeholder:"机器人令牌"},null,8,["modelValue"])])),_:1}),(0,h.Wm)(O,{label:"适配器"},{default:(0,h.w5)((()=>[(0,h.Wm)(H,{modelValue:e.form.adapter,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.adapter=t)},{default:(0,h.w5)((()=>[((0,h.wg)(!0),(0,h.iD)(h.HY,null,(0,h.Ko)(e.adapterType,((e,t)=>((0,h.wg)(),(0,h.j4)(z,{label:e,value:t,key:t},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,h.Wm)(O,{label:"随启动开启"},{default:(0,h.w5)((()=>[(0,h.Wm)(L,{modelValue:e.form.is_start,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.is_start=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1}),(0,h.Wm)(O,{label:"可控实例"},{default:(0,h.w5)((()=>[(0,h.Wm)(L,{modelValue:e.form.is_main,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.is_main=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1}),e.form.is_main?((0,h.wg)(),(0,h.j4)(O,{key:0,label:"控制台群组ID"},{default:(0,h.w5)((()=>[(0,h.Wm)($,{modelValue:e.form.console_channel,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.console_channel=t),placeholder:"控制实例的群组"},null,8,["modelValue"])])),_:1})):(0,h.kq)("",!0),e.txAdapters.indexOf(e.form.adapter)>=0?((0,h.wg)(),(0,h.iD)(h.HY,{key:1},[(0,h.Wm)(R,{"content-position":"left"},{default:(0,h.w5)((()=>[V])),_:1}),"qq_guild"===e.form.adapter?((0,h.wg)(),(0,h.j4)(O,{key:0,label:"属性"},{default:(0,h.w5)((()=>[(0,h.Wm)(Q,{modelValue:e.form.private,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.private=t)},{default:(0,h.w5)((()=>[(0,h.Wm)(A,{label:0},{default:(0,h.w5)((()=>[C])),_:1}),(0,h.Wm)(A,{label:1},{default:(0,h.w5)((()=>[U])),_:1})])),_:1},8,["modelValue"])])),_:1})):((0,h.wg)(),(0,h.iD)(h.HY,{key:1},[(0,h.Wm)(O,{label:"AppSecret"},{default:(0,h.w5)((()=>[(0,h.Wm)($,{modelValue:e.form.client_secret,"onUpdate:modelValue":t[7]||(t[7]=t=>e.form.client_secret=t),placeholder:"机器人密钥"},null,8,["modelValue"])])),_:1}),(0,h.Wm)(O,{label:"资源服务地址"},{default:(0,h.w5)((()=>[(0,h.Wm)($,{modelValue:e.form.host,"onUpdate:modelValue":t[8]||(t[8]=t=>e.form.host=t),placeholder:"资源服务的地址，默认为 0.0.0.0"},null,8,["modelValue"])])),_:1}),(0,h.Wm)(O,{label:"资源服务端口"},{default:(0,h.w5)((()=>[(0,h.Wm)($,{modelValue:e.form.http_port,"onUpdate:modelValue":t[9]||(t[9]=t=>e.form.http_port=t),placeholder:"资源服务的 HTTP 端口，默认为 8086"},null,8,["modelValue"])])),_:1})],64)),(0,h.Wm)(O,{label:"当前分片下标"},{default:(0,h.w5)((()=>[(0,h.Wm)(E,{modelValue:e.form.shard_index,"onUpdate:modelValue":t[10]||(t[10]=t=>e.form.shard_index=t)},null,8,["modelValue"])])),_:1}),(0,h.Wm)(O,{label:"分片总数"},{default:(0,h.w5)((()=>[(0,h.Wm)(E,{modelValue:e.form.shards,"onUpdate:modelValue":t[11]||(t[11]=t=>e.form.shards=t)},null,8,["modelValue"])])),_:1})],64)):(0,h.kq)("",!0),e.serverAdapters.indexOf(e.form.adapter)>=0?((0,h.wg)(),(0,h.iD)(h.HY,{key:2},[(0,h.Wm)(R,{"content-position":"left"},{default:(0,h.w5)((()=>[x])),_:1}),(0,h.Wm)(O,{label:"Host地址"},{default:(0,h.w5)((()=>[(0,h.Wm)($,{modelValue:e.form.host,"onUpdate:modelValue":t[12]||(t[12]=t=>e.form.host=t),placeholder:"服务的地址，本地默认为 127.0.0.1"},null,8,["modelValue"])])),_:1}),(0,h.Wm)(O,{label:"HTTP端口"},{default:(0,h.w5)((()=>[(0,h.Wm)($,{modelValue:e.form.http_port,"onUpdate:modelValue":t[13]||(t[13]=t=>e.form.http_port=t),placeholder:"服务的 HTTP 端口"},null,8,["modelValue"])])),_:1}),(0,h.Wm)(O,{label:"WS端口"},{default:(0,h.w5)((()=>[(0,h.Wm)($,{modelValue:e.form.ws_port,"onUpdate:modelValue":t[14]||(t[14]=t=>e.form.ws_port=t),placeholder:"服务的 Websocket 端口"},null,8,["modelValue"])])),_:1})],64)):(0,h.kq)("",!0)])),_:1},8,["form"])])}var D=a(2482),B=a(6520),T=a(4180),S=a(8418),P=function(e,t,a,o){var l,n=arguments.length,i=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,a,o);else for(var r=e.length-1;r>=0;r--)(l=e[r])&&(i=(n<3?l(i):n>3?l(t,a,i):l(t,a))||i);return n>3&&i&&Object.defineProperty(t,a,i),i};let I=class extends B.w3{constructor(...e){super(...e),(0,D.Z)(this,"table",void 0),(0,D.Z)(this,"dialog",void 0),(0,D.Z)(this,"adapterType",{qq_guild:"QQ频道机器人（官方）",qq_group:"QQ群机器人（官方）",qq_global:"QQ全域机器人（官方）",kook:"KOOK机器人",mirai_api_http:"Mirai-api-http QQ群机器人",cq_http:"CQ-Http QQ群机器人",onebot11:"OneBot 11 机器人",onebot12:"OneBot 12 机器人",com_wechat:"ComWeChat 微信机器人",websocket:"反向 Websocket"}),(0,D.Z)(this,"txAdapters",["qq_guild","qq_group","qq_global"]),(0,D.Z)(this,"serverAdapters",["mirai_api_http","cq_http","onebot11","onebot12","com_wechat","websocket"]),(0,D.Z)(this,"form",{}),(0,D.Z)(this,"formType","add")}async loadList(){const e=await(0,T.IX)();e&&this.table.setData(e.data)}newForm(){return{id:0,appid:"",token:"",private:0,adapter:"qq_guild",is_main:0,is_start:1,host:"",http_port:0,ws_port:0,client_secret:"",shard_index:0,shards:1}}addBot(){this.form=this.newForm(),this.formType="add",this.dialog.show()}editBot(e){this.form={...this.newForm(),...S.Z.deepCopy(e)},this.formType="edit",this.dialog.show()}async closeBot(e){const t=await(0,T.db)(e);t&&await this.table.executeLoad()}async runBot(e){const t=await(0,T.jW)(e);t&&await this.table.executeLoad()}async deleteBot(e){const t=await(0,T.pB)(e);t&&await this.table.executeLoad()}async submit(e){const t=await(0,T.Cv)({...this.form,start:e});t&&(await this.table.executeLoad(),this.dialog.hide())}};I=P([(0,B.Ei)({components:{VTable:c.Z,VFormDialog:o.Z},computed:{table(){return this.$refs.table},dialog(){return this.$refs.dialog}},mounted(){this.table.setColumns({appid:"APP ID",running:{title:"运行状态",format:(e,t)=>`<span class="status status-${(t||0).toString()}">${t?"运行中":"关闭"}</span>`},alive:{title:"在线状态",format:(e,t)=>`<span class="status status-${(t||0).toString()}">${t?"在线":"离线"}</span>`},adapter:{title:"适配器",format:(e,t)=>this.adapterType[t]},private:"属性",is_start:"随启动开启",is_main:"可控实例",console_channel:"控制台群组ID"})}})],I);var $=I,O=a(89);const z=(0,O.Z)($,[["render",j]]);var H=z},88:function(e,t,a){a(1758)},9910:function(e,t,a){a(1758),a(7195)},7219:function(e,t,a){a(1758)},9112:function(e,t,a){a(1758),a(172)},3189:function(e,t,a){a(1758)},7960:function(e,t,a){a(1758)},7195:function(e,t,a){a(1758)},6467:function(e,t,a){a(1758)},451:function(e,t,a){a(1758)},3877:function(e,t,a){a(1758),a(172),a(1430),a(7960),a(451),a(6467)},7029:function(e,t,a){a(1758)},9007:function(e,t,a){a(1758),a(88),a(1430)},6905:function(e,t,a){a(1758),a(88),a(1430),a(4566),a(451)},4566:function(e,t,a){a(1758),a(6467)}}]);
//# sourceMappingURL=865.6466ae09.js.map