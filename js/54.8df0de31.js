"use strict";(self["webpackChunkamiyabot_console"]=self["webpackChunkamiyabot_console"]||[]).push([[54],{5860:function(e,t,i){i.d(t,{Z:function(){return g}});var l=i(7947),o=(i(9910),i(1955)),a=(i(2064),i(3396));function s(e,t,i,s,n,r){const c=o.ly,d=l.d0;return(0,a.wg)(),(0,a.j4)(d,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=t=>e.dialogVisible=t),title:e.title,"append-to-body":e.appendToBody,width:e.width},{footer:(0,a.w5)((()=>[(0,a.WI)(e.$slots,"footer")])),default:(0,a.w5)((()=>[(0,a.Wm)(c,{model:e.form,"label-width":e.labelWidth},{default:(0,a.w5)((()=>[(0,a.WI)(e.$slots,"default")])),_:3},8,["model","label-width"])])),_:3},8,["modelValue","title","append-to-body","width"])}var n=i(2482),r=i(6520),c=function(e,t,i,l){var o,a=arguments.length,s=a<3?t:null===l?l=Object.getOwnPropertyDescriptor(t,i):l;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,i,l);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(s=(a<3?o(s):a>3?o(t,i,s):o(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s};let d=class extends r.w3{constructor(...e){super(...e),(0,n.Z)(this,"form",void 0),(0,n.Z)(this,"title",void 0),(0,n.Z)(this,"dialogVisible",!1)}show(){this.dialogVisible=!0}async asyncShow(){this.dialogVisible=!0,await this.$nextTick()}hide(){this.dialogVisible=!1}async asyncHide(){this.dialogVisible=!1,await this.$nextTick()}};d=c([(0,r.Ei)({props:{form:Object,title:String,width:Number,appendToBody:Boolean,labelWidth:{type:String,default:()=>"100px"}}})],d);var u=d,p=i(89);const h=(0,p.Z)(u,[["render",s]]);var g=h},86:function(e,t,i){i.r(t),i.d(t,{default:function(){return Ke}});var l=i(1932),o=(i(1758),i(534)),a=i(4550),s=(i(6905),i(9007),i(5860)),n=i(1955),r=(i(7113),i(432)),c=(i(812),i(6722)),d=i(5065),u=(i(3189),i(1015)),p=(i(8474),i(3417)),h=(i(172),i(2261)),g=(i(6809),i(3396)),w=i(7139);const f=e=>((0,g.dD)("data-v-bbbc0be0"),e=e(),(0,g.Cn)(),e),m={class:"header-panel"},y=(0,g.Uk)("上传创意插件"),k=(0,g.Uk)("批量安装插件"),b=(0,g.Uk)("取消批量安装"),_={class:"shop-panel"},v={class:"plugin-author"},P={class:"plugin-list"},C={style:{display:"flex","align-items":"center"}},U=(0,g.Uk)("更新"),W=(0,g.Uk)("安装 "),Z=(0,g.Uk)("卸载"),j={class:"more-options"},D=(0,g.Uk)("下载插件"),I=(0,g.Uk)("历史版本"),x=(0,g.Uk)("下架插件"),S={class:"upload-panel"},V=f((()=>(0,g._)("div",{class:"el-upload__text"},[(0,g.Uk)(" 拖动插件到此处或"),(0,g._)("em",null,"点击上传"),(0,g.Uk)("解析插件信息 ")],-1))),$={class:"el-upload__tip",style:{"font-size":"14px",display:"flex"}},M=(0,g.Uk)(" 仅支持通过 zip 打包的插件，大小不超过50MB。上传超大插件请 "),O=(0,g.Uk)("联系管理员"),q=(0,g.Uk)(" 获得帮助。 "),H={class:"uploaded-plugin"},L={class:"upload-result"},z={key:0,style:{"margin-right":"10px","font-size":"12px",color:"var(--el-color-danger)"}},T=(0,g.Uk)(" 忘记密钥 "),Y=(0,g.Uk)(" 确认提交 "),R={class:"v-table"},A=(0,g.Uk)("安装此版本 "),B=(0,g.Uk)("已安装"),K=(0,g.Uk)(" 下架 "),E={class:"batch-install-plugins"},F={style:{"margin-top":"20px","text-align":"center"}},G={style:{color:"#4CAF50"}},N=(0,g.Uk)("， 失败： "),X={style:{color:"#F44336"}};function Q(e,t,i,f,Q,J){const ee=h.mi,te=p.EZ,ie=(0,g.up)("shop-official"),le=(0,g.up)("CaretTop"),oe=u.gn,ae=(0,g.up)("CaretBottom"),se=d.E2,ne=(0,g.up)("plugin-item-card"),re=(0,g.up)("upload-filled"),ce=c.LW,de=r.v,ue=n.nH,pe=s.Z,he=a.$Y,ge=a.eI,we=o.Z,fe=l.Xh;return(0,g.wg)(),(0,g.iD)("div",null,[(0,g._)("div",m,[(0,g._)("div",null,[(0,g.Wm)(ee,{type:"primary",onClick:t[0]||(t[0]=t=>e.$refs.dialog.show())},{default:(0,g.w5)((()=>[y])),_:1}),e.batchMode?((0,g.wg)(),(0,g.j4)(ee,{key:1,type:"danger",onClick:t[2]||(t[2]=t=>e.batchMode=!1)},{default:(0,g.w5)((()=>[b])),_:1})):((0,g.wg)(),(0,g.j4)(ee,{key:0,onClick:t[1]||(t[1]=t=>e.batchMode=!0)},{default:(0,g.w5)((()=>[k])),_:1})),e.batchMode?((0,g.wg)(),(0,g.j4)(ee,{key:2,type:"success",onClick:e.batchInstall},{default:(0,g.w5)((()=>[(0,g.Uk)(" 安装（已选"+(0,w.zw)(Object.keys(e.batchList).length)+"） ",1)])),_:1},8,["onClick"])):(0,g.kq)("",!0)]),(0,g.Wm)(te,{style:{width:"520px"},modelValue:e.searchInput,"onUpdate:modelValue":t[3]||(t[3]=t=>e.searchInput=t),placeholder:"输入任意值搜索创意插件...",onChange:t[4]||(t[4]=t=>e.searchPlugins())},{append:(0,g.w5)((()=>[(0,g.Wm)(ee,{icon:e.searchIcon},null,8,["icon"])])),_:1},8,["modelValue"])]),(0,g._)("div",_,[(0,g.Wm)(ie,{"batch-mode":e.batchMode,ref:"officialShop",onSelected:e.selectPlugin,onUnselected:e.unselectedPlugin},null,8,["batch-mode","onSelected","onUnselected"]),((0,g.wg)(!0),(0,g.iD)(g.HY,null,(0,g.Ko)(e.pluginShowList,((t,i)=>((0,g.wg)(),(0,g.iD)(g.HY,{key:i},[(0,g._)("div",v,(0,w.zw)(i),1),(0,g._)("div",P,[((0,g.wg)(!0),(0,g.iD)(g.HY,null,(0,g.Ko)(t,((t,l)=>((0,g.wg)(),(0,g.j4)(ne,{key:l,item:t,author:i,"batch-mode":e.batchMode,"download-count":t.plugin_info.download_num,onSelected:i=>e.selectPlugin(t),onUnselected:i=>e.unselectedPlugin(t)},{version:(0,g.w5)((()=>[(0,g._)("div",C,[(0,g.Uk)((0,w.zw)(t.curr_version)+(0,w.zw)(t.version)+" ",1),t.upgrade?((0,g.wg)(),(0,g.j4)(oe,{key:0,style:{color:"var(--el-color-success)"}},{default:(0,g.w5)((()=>[(0,g.Wm)(le)])),_:1})):(0,g.kq)("",!0),t.higher?((0,g.wg)(),(0,g.j4)(oe,{key:1,style:{color:"var(--el-color-danger)"}},{default:(0,g.w5)((()=>[(0,g.Wm)(ae)])),_:1})):(0,g.kq)("",!0)])])),button:(0,g.w5)((()=>[t.upgrade?((0,g.wg)(),(0,g.j4)(ee,{key:0,round:"",type:"success",onClick:i=>e.upgrade(t)},{default:(0,g.w5)((()=>[U])),_:2},1032,["onClick"])):(0,g.kq)("",!0),t.installed?((0,g.wg)(),(0,g.j4)(ee,{key:2,round:"",type:"danger",onClick:i=>e.uninstall(t)},{default:(0,g.w5)((()=>[Z])),_:2},1032,["onClick"])):((0,g.wg)(),(0,g.j4)(ee,{key:1,round:"",type:"primary",onClick:i=>e.install(t)},{default:(0,g.w5)((()=>[W])),_:2},1032,["onClick"])),(0,g._)("div",j,[(0,g.Wm)(se,{type:"primary",onClick:i=>e.downloadPlugin(t)},{default:(0,g.w5)((()=>[D])),_:2},1032,["onClick"]),(0,g.Wm)(se,{type:"warning",onClick:i=>e.getHistory(t)},{default:(0,g.w5)((()=>[I])),_:2},1032,["onClick"]),(0,g.Wm)(se,{type:"danger",onClick:i=>e.deletePlugin(t)},{default:(0,g.w5)((()=>[x])),_:2},1032,["onClick"])])])),_:2},1032,["item","author","batch-mode","download-count","onSelected","onUnselected"])))),128))])],64)))),128))]),(0,g.Wm)(pe,{title:"上传创意插件",form:e.form,ref:"dialog",width:1200},{footer:(0,g.w5)((()=>[e.isUpload&&!e.uploadedPlugin.ready?((0,g.wg)(),(0,g.iD)("span",z,"请解决所有问题后提交")):(0,g.kq)("",!0),(0,g.Wm)(ee,{onClick:e.forgotKey},{default:(0,g.w5)((()=>[T])),_:1},8,["onClick"]),(0,g.Wm)(ee,{type:"primary",disabled:!e.isUpload||!e.uploadedPlugin.ready,onClick:e.commit},{default:(0,g.w5)((()=>[Y])),_:1},8,["disabled","onClick"])])),default:(0,g.w5)((()=>[(0,g._)("div",S,[(0,g.Wm)(ce,{drag:"",action:e.uploadUrl,"show-file-list":!1,"on-success":e.uploaded,"on-error":e.uploadFail,"before-upload":e.beforeUpload},{tip:(0,g.w5)((()=>[(0,g._)("div",$,[M,(0,g.Wm)(se,{class:"link",type:"primary",onClick:e.callAdmin},{default:(0,g.w5)((()=>[O])),_:1},8,["onClick"]),q])])),default:(0,g.w5)((()=>[(0,g.Wm)(oe,{class:"el-icon--upload"},{default:(0,g.w5)((()=>[(0,g.Wm)(re)])),_:1}),V])),_:1},8,["action","on-success","on-error","before-upload"]),(0,g._)("div",H,[e.isUpload?((0,g.wg)(),(0,g.j4)(de,{key:0,class:"upload-status",title:"解析成功","show-icon":"",type:"success",closable:!1})):((0,g.wg)(),(0,g.j4)(de,{key:1,class:"upload-status",title:"请上传插件进行解析","show-icon":"",type:"info",closable:!1})),e.isUpload?((0,g.wg)(),(0,g.j4)(ne,{key:2,item:e.uploadedPlugin,"on-list":!1,"detail-mode":!0},null,8,["item"])):(0,g.kq)("",!0)])]),(0,g._)("div",L,[e.isUpload?((0,g.wg)(),(0,g.iD)(g.HY,{key:0},[e.uploadedPlugin.success.length?((0,g.wg)(!0),(0,g.iD)(g.HY,{key:0},(0,g.Ko)(e.uploadedPlugin.success,((e,t)=>((0,g.wg)(),(0,g.j4)(de,{key:t,title:e,"show-icon":"",type:"success",effect:"dark",closable:!1},null,8,["title"])))),128)):(0,g.kq)("",!0),e.uploadedPlugin.error.length?((0,g.wg)(!0),(0,g.iD)(g.HY,{key:1},(0,g.Ko)(e.uploadedPlugin.error,((e,t)=>((0,g.wg)(),(0,g.j4)(de,{key:t,title:e,"show-icon":"",type:"error",effect:"dark",closable:!1},null,8,["title"])))),128)):((0,g.wg)(),(0,g.j4)(de,{key:2,title:"通过校验，允许上传","show-icon":"",type:"success",effect:"dark",closable:!1})),e.uploadedPlugin.warning.length?((0,g.wg)(!0),(0,g.iD)(g.HY,{key:3},(0,g.Ko)(e.uploadedPlugin.warning,((e,t)=>((0,g.wg)(),(0,g.j4)(de,{key:t,title:e,"show-icon":"",type:"warning",effect:"dark",closable:!1},null,8,["title"])))),128)):(0,g.kq)("",!0)],64)):(0,g.kq)("",!0)]),(0,g.Wm)(ue,{label:"作者名称"},{default:(0,g.w5)((()=>[(0,g.Wm)(te,{modelValue:e.form.author,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.author=t),placeholder:"请输入插件作者的名称"},null,8,["modelValue"])])),_:1}),(0,g.Wm)(ue,{label:"插件密钥"},{default:(0,g.w5)((()=>[(0,g.Wm)(te,{modelValue:e.form.secret_key,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.secret_key=t),placeholder:"密钥用于绑定插件ID，当后续继续上传此ID的插件时需要验证上一次的密钥"},null,8,["modelValue"])])),_:1}),(0,g.Wm)(ue,{label:"备注"},{default:(0,g.w5)((()=>[(0,g.Wm)(te,{modelValue:e.form.remark,"onUpdate:modelValue":t[7]||(t[7]=t=>e.form.remark=t),type:"textarea",placeholder:"选填..."},null,8,["modelValue"])])),_:1})])),_:1},8,["form"]),(0,g.Wm)(we,{title:"历史版本",ref:"history","append-to-body":!0},{default:(0,g.w5)((()=>[(0,g._)("div",R,[(0,g.Wm)(ge,{data:e.pluginsHistory,style:{width:"100%"},height:"250","header-cell-class-name":"v-table-header"},{default:(0,g.w5)((()=>[(0,g.Wm)(he,{prop:"name",label:"插件名"}),(0,g.Wm)(he,{prop:"version",label:"版本"}),(0,g.Wm)(he,{prop:"upload_time",label:"上传时间"}),(0,g.Wm)(he,{label:"操作",fixed:"right"},{default:(0,g.w5)((t=>[e.currPlugin.version!==t.row.installed_version?((0,g.wg)(),(0,g.j4)(se,{key:0,underline:!1,type:"primary",onClick:i=>e.install(t.row)},{default:(0,g.w5)((()=>[A])),_:2},1032,["onClick"])):((0,g.wg)(),(0,g.j4)(se,{key:1,underline:!1,type:"info",disabled:""},{default:(0,g.w5)((()=>[B])),_:1})),(0,g.Wm)(se,{underline:!1,type:"danger",onClick:i=>e.deleteHistory(t.row)},{default:(0,g.w5)((()=>[K])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])])),_:1},512),(0,g.Wm)(we,{ref:"batchInstall",title:"批量安装插件",onClosed:e.getPlugins},{default:(0,g.w5)((()=>[(0,g._)("div",E,[((0,g.wg)(!0),(0,g.iD)(g.HY,null,(0,g.Ko)(e.batchList,((t,i)=>((0,g.wg)(),(0,g.iD)("div",{class:(0,w.C_)(e.batchInstallProcess.status[t.plugin_id]),key:i},(0,w.zw)(t.name),3)))),128))]),(0,g.Wm)(fe,{"text-inside":!0,"stroke-width":16,status:e.batchInstallProcess.percentage>=100?"success":"",percentage:e.batchInstallProcess.percentage},null,8,["status","percentage"]),(0,g._)("div",F,[(0,g.Uk)(" 总数："+(0,w.zw)(Object.keys(e.batchList).length)+"， 成功： ",1),(0,g._)("span",G,(0,w.zw)(Object.values(e.batchInstallProcess.status).filter((e=>"success"===e)).length),1),N,(0,g._)("span",X,(0,w.zw)(Object.values(e.batchInstallProcess.status).filter((e=>"success"!==e)).length),1)])])),_:1},8,["onClosed"])])}var J=i(2482),ee=i(4870),te=i(6520),ie=i(6532),le=i(1677),oe=i(2748),ae=i(9037);const se={class:"plugin-title"},ne={class:"plugin-icon"},re=["src"],ce={key:1,class:"installed-icon"},de={class:"plugin-info"},ue={class:"plugin-name"},pe={class:"plugin-name-text"},he={key:0,class:"official-icon"},ge={style:{color:"var(--el-color-primary)"}},we={key:0},fe={class:"desc"};function me(e,t,i,l,a,s){const n=(0,g.up)("plugin-detail"),r=o.Z;return(0,g.wg)(),(0,g.iD)(g.HY,null,[(0,g._)("div",{class:(0,w.C_)(["plugin-item",{upgrade:e.item.upgrade,installed:e.item.installed,"detail-mode":e.detailMode,"batch-mode":e.batchMode,selected:e.selected}]),onClick:t[0]||(t[0]=(...t)=>e.onclick&&e.onclick(...t))},[(0,g._)("div",se,[(0,g._)("div",ne,[e.logo?((0,g.wg)(),(0,g.iD)("img",{key:0,src:e.logo,alt:"logo"},null,8,re)):(0,g.kq)("",!0),e.item.installed?((0,g.wg)(),(0,g.iD)("span",ce)):(0,g.kq)("",!0)]),(0,g._)("div",de,[(0,g._)("div",ue,[(0,g._)("div",pe,[(0,g.WI)(e.$slots,"name",{item:e.item},(()=>[(0,g.Uk)((0,w.zw)(e.item.name),1)]),!0)]),"official"===e.item.plugin_type?((0,g.wg)(),(0,g.iD)("div",he)):(0,g.kq)("",!0)]),(0,g._)("div",ge,[(0,g.WI)(e.$slots,"version",{item:e.item},(()=>[(0,g.Uk)((0,w.zw)(e.item.version),1)]),!0)])])]),e.detailMode?((0,g.wg)(),(0,g.iD)("div",we,[(0,g._)("div",fe,(0,w.zw)(e.item.description),1)])):(0,g.kq)("",!0)],2),(0,g.Wm)(r,{class:"plugin-detail",ref:"dialog","append-to-body":!0,"show-close":!1,width:"60%"},{default:(0,g.w5)((()=>[(0,g.Wm)(n,{item:e.item,author:e.author,"download-count":e.downloadCount},{author:(0,g.w5)((()=>[(0,g.WI)(e.$slots,"author",{},void 0,!0)])),button:(0,g.w5)((()=>[(0,g.WI)(e.$slots,"button",{},void 0,!0)])),version:(0,g.w5)((()=>[(0,g.WI)(e.$slots,"version",{},void 0,!0)])),_:3},8,["item","author","download-count"])])),_:3},512)],64)}var ye=i(3969),ke=function(e,t,i,l){var o,a=arguments.length,s=a<3?t:null===l?l=Object.getOwnPropertyDescriptor(t,i):l;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,i,l);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(s=(a<3?o(s):a>3?o(t,i,s):o(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s};let be=class extends te.w3{constructor(...e){super(...e),(0,J.Z)(this,"item",void 0),(0,J.Z)(this,"dialog",void 0),(0,J.Z)(this,"batchMode",void 0),(0,J.Z)(this,"selected",!1)}onclick(){if(this.batchMode){if(this.item.installed&&!this.item.upgrade)return;this.selected?(this.selected=!1,this.$emit("unselected")):(this.selected=!0,this.$emit("selected"))}else this.dialog.show()}};be=ke([(0,te.Ei)({emits:["selected","unselected"],components:{VDialog:o.Z,PluginDetail:ye.Z},computed:{dialog(){return this.$refs.dialog},logo(){return(0,ye.V)(this.item)}},props:{item:Object,author:String,downloadCount:Number,detailMode:Boolean,batchMode:Boolean},watch:{batchMode(){this.selected=!1}}})],be);var _e=be,ve=i(89);const Pe=(0,ve.Z)(_e,[["render",me],["__scopeId","data-v-b9cc35d8"]]);var Ce=Pe;const Ue=e=>((0,g.dD)("data-v-0d46bdd7"),e=e(),(0,g.Cn)(),e),We=Ue((()=>(0,g._)("div",{class:"plugin-author"},"官方插件",-1))),Ze={class:"plugin-list"},je={style:{display:"flex","align-items":"center"}},De=(0,g.Uk)("更新"),Ie=(0,g.Uk)("安装"),xe=(0,g.Uk)(" 卸载 "),Se={class:"more-options"},Ve=(0,g.Uk)("下载插件");function $e(e,t,i,l,o,a){const s=(0,g.up)("CaretTop"),n=u.gn,r=(0,g.up)("CaretBottom"),c=h.mi,p=d.E2,f=(0,g.up)("plugin-item-card");return(0,g.wg)(),(0,g.iD)(g.HY,null,[We,(0,g._)("div",Ze,[((0,g.wg)(!0),(0,g.iD)(g.HY,null,(0,g.Ko)(e.officialPlugins,((t,i)=>((0,g.wg)(),(0,g.j4)(f,{key:i,item:t,"batch-mode":e.batchMode,onSelected:()=>this.$emit("selected",t),onUnselected:()=>this.$emit("unselected",t)},{version:(0,g.w5)((()=>[(0,g._)("div",je,[(0,g.Uk)((0,w.zw)(t.curr_version)+(0,w.zw)(t.version)+" ",1),t.upgrade?((0,g.wg)(),(0,g.j4)(n,{key:0,style:{color:"var(--el-color-success)"}},{default:(0,g.w5)((()=>[(0,g.Wm)(s)])),_:1})):(0,g.kq)("",!0),t.higher?((0,g.wg)(),(0,g.j4)(n,{key:1,style:{color:"var(--el-color-danger)"}},{default:(0,g.w5)((()=>[(0,g.Wm)(r)])),_:1})):(0,g.kq)("",!0)])])),button:(0,g.w5)((()=>[t.upgrade?((0,g.wg)(),(0,g.j4)(c,{key:0,round:"",type:"success",onClick:i=>e.upgrade(t)},{default:(0,g.w5)((()=>[De])),_:2},1032,["onClick"])):(0,g.kq)("",!0),t.installed?((0,g.wg)(),(0,g.j4)(c,{key:2,round:"",type:"danger",onClick:i=>e.uninstall(t),style:{"margin-left":"10px"}},{default:(0,g.w5)((()=>[xe])),_:2},1032,["onClick"])):((0,g.wg)(),(0,g.j4)(c,{key:1,round:"",type:"primary",onClick:i=>e.install(t)},{default:(0,g.w5)((()=>[Ie])),_:2},1032,["onClick"])),(0,g._)("div",Se,[(0,g.Wm)(p,{type:"primary",onClick:i=>e.downloadPlugin(t)},{default:(0,g.w5)((()=>[Ve])),_:2},1032,["onClick"])])])),_:2},1032,["item","batch-mode","onSelected","onUnselected"])))),128))])],64)}var Me=function(e,t,i,l){var o,a=arguments.length,s=a<3?t:null===l?l=Object.getOwnPropertyDescriptor(t,i):l;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,i,l);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(s=(a<3?o(s):a>3?o(t,i,s):o(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s};let Oe=class extends te.w3{constructor(...e){super(...e),(0,J.Z)(this,"officialPlugins",[])}async getShopList(){const e=await(0,ie.f0)();if(e){const t=await(0,ie.M4)(),i={};if(t){const e=t.data;for(const t of e)i[t.plugin_id]=t.version}this.officialPlugins=e.filter((e=>(e.installed=e.plugin_id in i,e.upgrade=!!i[e.plugin_id]&&e.version>i[e.plugin_id],e.higher=!!i[e.plugin_id]&&e.version<i[e.plugin_id],e.upgrade&&(e.curr_version=i[e.plugin_id]+" >> "),e.higher&&(e.curr_version=i[e.plugin_id]+" << "),!0)))}}async install(e){const t=await(0,ie.Tk)(e);t&&await this.getShopList()}async upgrade(e){const t=await(0,ie.GU)(e);t&&await this.getShopList()}async uninstall(e){const t=await(0,ie.GP)(e);t&&await this.getShopList()}async downloadPlugin(e){const t=(0,ie.bY)(e);location.href=t.url}};Oe=Me([(0,te.Ei)({emits:["selected","unselected"],props:{batchMode:Boolean},components:{CaretTop:oe.Vx7,CaretBottom:oe.HXv,PluginItemCard:Ce}})],Oe);var qe=Oe;const He=(0,ve.Z)(qe,[["render",$e],["__scopeId","data-v-0d46bdd7"]]);var Le=He,ze=i(8418),Te=i(8199),Ye=function(e,t,i,l){var o,a=arguments.length,s=a<3?t:null===l?l=Object.getOwnPropertyDescriptor(t,i):l;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,i,l);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(s=(a<3?o(s):a>3?o(t,i,s):o(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s};let Re=class extends te.w3{constructor(...e){super(...e),(0,J.Z)(this,"dialog",void 0),(0,J.Z)(this,"historyDialog",void 0),(0,J.Z)(this,"batchInstallDialog",void 0),(0,J.Z)(this,"officialShop",void 0),(0,J.Z)(this,"form",{author:"",secret_key:"",remark:""}),(0,J.Z)(this,"searchIcon",(0,ee.XI)(oe.olm)),(0,J.Z)(this,"searchInput",""),(0,J.Z)(this,"batchMode",!1),(0,J.Z)(this,"batchList",{}),(0,J.Z)(this,"batchInstallProcess",{percentage:0,status:{}}),(0,J.Z)(this,"pluginAuthors",{}),(0,J.Z)(this,"pluginShowList",{}),(0,J.Z)(this,"pluginsHistory",[]),(0,J.Z)(this,"currPlugin",{}),(0,J.Z)(this,"uploadedPlugin",{})}searchPlugins(){const e={},t=this.searchInput.toLowerCase();""===t&&(this.pluginShowList=this.pluginAuthors);for(const i in this.pluginAuthors)if(i.toLowerCase().indexOf(t)>=0)e[i]=this.pluginAuthors[i];else for(const l of this.pluginAuthors[i])l.name.toLowerCase().indexOf(t)>=0&&(e[i]||(e[i]=[]),e[i].push(l));this.pluginShowList=e}async getPlugins(){this.batchMode=!1,await this.officialShop.getShopList();const e=await(0,le.lQ)();if(e){const t=await(0,ie.M4)(),i={};if(t){const e=t.data;for(const t of e)i[t.plugin_id]=t.version}const l=e.data.filter((e=>(e.installed=e.plugin_id in i,e.upgrade=!!i[e.plugin_id]&&e.version>i[e.plugin_id],e.higher=!!i[e.plugin_id]&&e.version<i[e.plugin_id],e.installed_version=i[e.plugin_id],e.upgrade&&(e.curr_version=i[e.plugin_id]+" >> "),e.higher&&(e.curr_version=i[e.plugin_id]+" << "),!0))),o={};for(const e of l)e.plugin_info.author in o||(o[e.plugin_info.author]=[]),o[e.plugin_info.author].push(e);for(const e in o)o[e].sort(((e,t)=>new Date(t.upload_time).getTime()-new Date(e.upload_time).getTime()));const a=Object.entries(o).map((([e,t])=>({name:e,arr:t,maxTime:new Date(t[0].upload_time).getTime()})));a.sort(((e,t)=>t.maxTime-e.maxTime));const s={};for(const e of a)s[e.name]=e.arr;this.pluginAuthors=s,this.pluginShowList=ze.Z.deepCopy(s)}}async getHistory(e){const t=await(0,le.ai)(e);t&&(this.currPlugin=e,this.pluginsHistory=t.data,this.historyDialog.show())}async uploaded(e){"ok"===e.status?(this.form.author=e.author||"",this.uploadedPlugin=e):await ae.Z.alert("异常信息：<br>"+e.message.replace(/\n/g,"<br>"),"插件解析失败",(()=>null),"error")}async beforeUpload(e){if(e.size>=52428800)return await ae.Z.confirm("插件大小不能超过50MB。上传超大插件请联系管理员获得帮助。","文件体积过大","error",["联系管理员","不了"])&&await this.callAdmin(),!1}async uploadFail(){this.uploadedPlugin={},await ae.Z.alert("插件服务器异常。","插件上传失败",(()=>null),"error")}async forgotKey(){await ae.Z.confirm("忘记密钥请联系管理员获得帮助。","忘记密钥","info",["联系管理员","再想一想"])&&await this.callAdmin()}async callAdmin(){window.open("https://qun.qq.com/qqweb/qunpro/share?_wv=3&_wwv=128&appChannel=share&inviteCode=1W4sJux&appChannel=share&businessType=9&from=181074&biz=ka&shareSource=5")}async commit(){const e=await(0,le.$m)({...this.uploadedPlugin,...this.form});e&&(this.dialog.hide(),this.uploadedPlugin={},this.form.author="",this.form.secret_key="",this.form.remark="",await this.getPlugins())}async downloadPlugin(e){const t=(0,ie.bY)(e);location.href=t.url}async deletePlugin(e){const t=await ae.Z.prompt("输入插件密钥");if(t&&await ae.Z.confirm(`确认下架插件【${e.name} v${e.version}】？`)){const i=await(0,le.K8)({...e,force_delete:!await ae.Z.confirm("是否仅下架该版本？否则永久下架将会释放该插件ID，并删除历史版本。","请注意","warning",["仅下架该版本","永久下架"]),secret_key:t});i&&await this.getPlugins()}}async deleteHistory(e){const t=await ae.Z.prompt("输入插件密钥");if(t&&await ae.Z.confirm(`确认下架插件【${e.name} v${e.version}】？`)){const i=await(0,le.K8)({...e,force_delete:!1,secret_key:t});i&&(await this.getHistory(e),await this.getPlugins())}}async install(e){const t=await(0,ie.Tk)(e);t&&(this.historyDialog.hide(),await this.getPlugins())}async upgrade(e){const t=await(0,ie.GU)(e);t&&await this.getPlugins()}async uninstall(e){const t=await(0,ie.GP)(e);t&&await this.getPlugins()}async batchInstall(){const e=Object.values(this.batchList);0!==e.length?await ae.Z.confirm(`将批量安装已选的 ${e.length} 个插件，请确定你已经阅读过它们的文档以确保你符合安装条件，否则安装过程中部分插件可能安装失败。`)&&(this.batchInstallProcess.status={},this.batchInstallProcess.percentage=0,await this.batchInstallDialog.asyncShow(),await Te.u.silentRequest((async()=>{for(const t in e){const i=e[t];let l;l=i.upgrade?await(0,ie.GU)(i):await(0,ie.Tk)(i),this.batchInstallProcess.status[i.plugin_id]=l?"success":"error",this.batchInstallProcess.percentage=Number(((Number(t)+1)/e.length*100).toFixed(0))}}))):ae.Z.toast("未选择插件")}selectPlugin(e){this.batchList[e.plugin_id]=e}unselectedPlugin(e){delete this.batchList[e.plugin_id]}};Re=Ye([(0,te.Ei)({components:{CaretTop:oe.Vx7,CaretBottom:oe.HXv,UploadFilled:oe.AQM,VDialog:o.Z,VFormDialog:s.Z,PluginItemCard:Ce,ShopOfficial:Le},computed:{isUpload(){return Object.keys(this.uploadedPlugin).length},officialShop(){return this.$refs.officialShop},dialog(){return this.$refs.dialog},historyDialog(){return this.$refs.history},batchInstallDialog(){return this.$refs.batchInstall}},watch:{batchMode(){this.batchList={}}},data(){return{uploadUrl:le._$}},mounted(){this.getPlugins()}})],Re);var Ae=Re;const Be=(0,ve.Z)(Ae,[["render",Q],["__scopeId","data-v-bbbc0be0"]]);var Ke=Be},812:function(e,t,i){i(1758)}}]);
//# sourceMappingURL=54.8df0de31.js.map